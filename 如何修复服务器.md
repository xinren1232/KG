# å¦‚ä½•ä¿®å¤é˜¿é‡Œäº‘æœåŠ¡å™¨

## ðŸš€ æœ€ç®€å•çš„æ–¹æ³•ï¼ˆæŽ¨èï¼‰

### æ–¹æ³•1ï¼šå¤åˆ¶ç²˜è´´ä¸€é”®ä¿®å¤

1. **æ‰“å¼€SSHè¿žæŽ¥**ï¼š
   ```bash
   ssh root@47.108.152.16
   ```
   è¾“å…¥å¯†ç ç™»å½•

2. **å¤åˆ¶ä»¥ä¸‹å®Œæ•´å‘½ä»¤**ï¼Œç²˜è´´åˆ°SSHç»ˆç«¯ï¼ŒæŒ‰å›žè½¦ï¼š

```bash
cd /opt/kg && \
echo "=== å½“å‰çŠ¶æ€ ===" && \
docker-compose -f docker-compose.prod.yml ps && \
echo "" && echo "=== é‡å¯Redis ===" && \
docker-compose -f docker-compose.prod.yml restart redis && \
sleep 3 && \
echo "=== é‡å¯API ===" && \
docker-compose -f docker-compose.prod.yml restart api && \
sleep 5 && \
echo "" && echo "=== ä¿®å¤åŽçŠ¶æ€ ===" && \
docker-compose -f docker-compose.prod.yml ps && \
echo "" && echo "=== æµ‹è¯•API ===" && \
docker exec kg_api_prod curl -s http://localhost:8000/health && \
echo "" && echo "=== å®Œæˆ ===" && \
echo "è¯·è®¿é—®: http://47.108.152.16/"
```

3. **ç­‰å¾…æ‰§è¡Œå®Œæˆ**ï¼ˆçº¦10ç§’ï¼‰

4. **åˆ·æ–°æµè§ˆå™¨**ï¼šè®¿é—® http://47.108.152.16/

---

### æ–¹æ³•2ï¼šä½¿ç”¨è„šæœ¬æ–‡ä»¶

1. **ç™»å½•æœåŠ¡å™¨**ï¼š
   ```bash
   ssh root@47.108.152.16
   ```

2. **åˆ›å»ºä¿®å¤è„šæœ¬**ï¼š
   ```bash
   cat > /tmp/fix.sh << 'EOF'
   #!/bin/bash
   cd /opt/kg
   echo "é‡å¯Redis..."
   docker-compose -f docker-compose.prod.yml restart redis
   sleep 3
   echo "é‡å¯API..."
   docker-compose -f docker-compose.prod.yml restart api
   sleep 5
   echo "æ£€æŸ¥çŠ¶æ€..."
   docker-compose -f docker-compose.prod.yml ps
   echo "æµ‹è¯•API..."
   docker exec kg_api_prod curl -s http://localhost:8000/health
   echo ""
   echo "ä¿®å¤å®Œæˆï¼è®¿é—®: http://47.108.152.16/"
   EOF
   ```

3. **æ‰§è¡Œè„šæœ¬**ï¼š
   ```bash
   bash /tmp/fix.sh
   ```

---

### æ–¹æ³•3ï¼šåˆ†æ­¥æ‰§è¡Œï¼ˆå¦‚æžœéœ€è¦è¯¦ç»†æŸ¥çœ‹æ¯ä¸€æ­¥ï¼‰

ç™»å½•æœåŠ¡å™¨åŽï¼Œä¾æ¬¡æ‰§è¡Œï¼š

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/kg

# 2. æŸ¥çœ‹å½“å‰çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# 3. æŸ¥çœ‹APIæ—¥å¿—ï¼ˆæ‰¾å‡ºé—®é¢˜ï¼‰
docker-compose -f docker-compose.prod.yml logs api --tail=30

# 4. é‡å¯Redis
docker-compose -f docker-compose.prod.yml restart redis

# 5. ç­‰å¾…3ç§’
sleep 3

# 6. é‡å¯API
docker-compose -f docker-compose.prod.yml restart api

# 7. ç­‰å¾…5ç§’
sleep 5

# 8. æ£€æŸ¥çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# 9. æµ‹è¯•API
docker exec kg_api_prod curl -s http://localhost:8000/health
```

---

## ðŸ” å¦‚ä½•éªŒè¯ä¿®å¤æˆåŠŸ

### åœ¨æœåŠ¡å™¨ä¸ŠéªŒè¯

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost/health

# æµ‹è¯•APIç«¯ç‚¹
curl http://localhost/api/kg/real-stats | head -c 200
```

åº”è¯¥çœ‹åˆ°JSONæ•°æ®ï¼Œè€Œä¸æ˜¯é”™è¯¯ä¿¡æ¯ã€‚

### åœ¨æµè§ˆå™¨ä¸­éªŒè¯

1. è®¿é—® http://47.108.152.16/
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. æŸ¥çœ‹ **Console** æ ‡ç­¾ï¼š
   - âœ… åº”è¯¥çœ‹åˆ°ï¼š`æœ€ç»ˆç»Ÿè®¡æ•°æ®: {dictEntries: 1275, ...}`
   - âŒ ä¸åº”è¯¥çœ‹åˆ°ï¼š`çœŸå®žç»Ÿè®¡APIä¸å¯ç”¨`

4. æŸ¥çœ‹ **Network** æ ‡ç­¾ï¼š
   - æ‰¾åˆ° `real-stats` è¯·æ±‚
   - âœ… çŠ¶æ€åº”è¯¥æ˜¯ï¼š`200 OK`
   - âŒ ä¸åº”è¯¥æ˜¯ï¼š`502 Bad Gateway`

---

## âš ï¸ å¦‚æžœè¿˜æ˜¯ä¸è¡Œ

### æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

```bash
ssh root@47.108.152.16
cd /opt/kg
docker-compose -f docker-compose.prod.yml logs api --tail=100
```

æŠŠæ—¥å¿—è¾“å‡ºå¤åˆ¶ç»™æˆ‘ï¼Œæˆ‘ä¼šå¸®ä½ è¿›ä¸€æ­¥è¯Šæ–­ã€‚

### å®Œå…¨é‡å¯æ‰€æœ‰æœåŠ¡

```bash
ssh root@47.108.152.16
cd /opt/kg

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml down

# é‡æ–°å¯åŠ¨
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f
```

æŒ‰ `Ctrl+C` é€€å‡ºæ—¥å¿—æŸ¥çœ‹ã€‚

---

## ðŸ“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æŸ¥çœ‹å®žæ—¶æ—¥å¿—ï¼Ÿ
```bash
docker-compose -f docker-compose.prod.yml logs -f api
```
æŒ‰ `Ctrl+C` é€€å‡ºã€‚

### Q: å¦‚ä½•è¿›å…¥å®¹å™¨å†…éƒ¨ï¼Ÿ
```bash
docker exec -it kg_api_prod bash
```
è¾“å…¥ `exit` é€€å‡ºã€‚

### Q: å¦‚ä½•æ£€æŸ¥æ‰€æœ‰å®¹å™¨çŠ¶æ€ï¼Ÿ
```bash
docker-compose -f docker-compose.prod.yml ps
```

### Q: å¦‚ä½•é‡å¯å•ä¸ªæœåŠ¡ï¼Ÿ
```bash
# é‡å¯API
docker-compose -f docker-compose.prod.yml restart api

# é‡å¯Nginx
docker-compose -f docker-compose.prod.yml restart nginx

# é‡å¯Neo4j
docker-compose -f docker-compose.prod.yml restart neo4j
```

---

## ðŸŽ¯ å¿«é€Ÿå‚è€ƒ

| æ“ä½œ | å‘½ä»¤ |
|------|------|
| ç™»å½•æœåŠ¡å™¨ | `ssh root@47.108.152.16` |
| è¿›å…¥é¡¹ç›®ç›®å½• | `cd /opt/kg` |
| æŸ¥çœ‹å®¹å™¨çŠ¶æ€ | `docker-compose -f docker-compose.prod.yml ps` |
| é‡å¯API | `docker-compose -f docker-compose.prod.yml restart api` |
| æŸ¥çœ‹APIæ—¥å¿— | `docker-compose -f docker-compose.prod.yml logs api --tail=50` |
| æµ‹è¯•API | `curl http://localhost/api/kg/real-stats` |
| å®Œå…¨é‡å¯ | `docker-compose -f docker-compose.prod.yml down && docker-compose -f docker-compose.prod.yml up -d` |

---

## ðŸ’¡ æç¤º

- ä¿®å¤åŽéœ€è¦ç­‰å¾…5-10ç§’è®©æœåŠ¡å®Œå…¨å¯åŠ¨
- å¦‚æžœæµè§ˆå™¨è¿˜æ˜¾ç¤ºé”™è¯¯ï¼ŒæŒ‰ `Ctrl+F5` å¼ºåˆ¶åˆ·æ–°
- å»ºè®®é…ç½®SSHå¯†é’¥å…å¯†ç™»å½•ï¼Œé¿å…æ¯æ¬¡è¾“å…¥å¯†ç 

---

**æœåŠ¡å™¨**: 47.108.152.16  
**é¡¹ç›®è·¯å¾„**: /opt/kg  
**è®¿é—®åœ°å€**: http://47.108.152.16/

