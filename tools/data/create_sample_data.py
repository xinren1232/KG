#!/usr/bin/env python3
"""
创建示例数据，模拟用户的"来料问题先后版.xlsx"
用于演示完整的自动抽取和知识图谱构建流程
"""
import pandas as pd
from pathlib import Path
import random
from datetime import datetime, timedelta

def create_sample_excel_data():
    """创建示例Excel数据"""
    
    # 模拟来料问题数据
    sample_data = [
        {
            '问题编号': 'IQC-2024-001',
            '来料批次': 'LOT-20241201-A',
            '供应商': '深圳XX电子有限公司',
            '物料名称': '摄像头模组',
            '物料型号': 'CAM-8MP-001',
            '问题描述': '摄像头对焦功能异常，无法正常对焦',
            '问题分类': '功能异常',
            '严重程度': 'S1',
            '发现时间': '2024-12-01 09:30:00',
            '发现人员': '张三',
            '影响产品': 'MyPhoneX',
            '影响数量': 500,
            '处理状态': '处理中',
            '根本原因': '镜头组装工艺问题',
            '纠正措施': '要求供应商改进装配工艺',
            '预防措施': '增加来料检验项目',
            '关闭时间': None,
            '备注': '已通知供应商，等待改善方案'
        },
        {
            '问题编号': 'IQC-2024-002',
            '来料批次': 'LOT-20241202-B',
            '供应商': '东莞YY科技股份有限公司',
            '物料名称': '电池模组',
            '物料型号': 'BAT-4000mAh-002',
            '问题描述': '电池充电速度明显低于规格要求',
            '问题分类': '性能不达标',
            '严重程度': 'S2',
            '发现时间': '2024-12-02 14:15:00',
            '发现人员': '李四',
            '影响产品': 'MyPhoneY',
            '影响数量': 200,
            '处理状态': '已关闭',
            '根本原因': '电芯内阻偏高',
            '纠正措施': '更换电芯供应商',
            '预防措施': '建立电芯内阻检测标准',
            '关闭时间': '2024-12-05 16:00:00',
            '备注': '问题已解决，新批次验证通过'
        },
        {
            '问题编号': 'IQC-2024-003',
            '来料批次': 'LOT-20241203-C',
            '供应商': '苏州ZZ光电技术有限公司',
            '物料名称': '显示屏',
            '物料型号': 'LCD-6.1-OLED-003',
            '问题描述': '屏幕显示出现色彩偏差，偏红现象',
            '问题分类': '外观缺陷',
            '严重程度': 'S2',
            '发现时间': '2024-12-03 11:20:00',
            '发现人员': '王五',
            '影响产品': 'MyPhoneZ',
            '影响数量': 150,
            '处理状态': '分析中',
            '根本原因': '背光模组色温偏差',
            '纠正措施': '调整背光模组参数',
            '预防措施': '增加色温检测工序',
            '关闭时间': None,
            '备注': '正在进行根因分析'
        },
        {
            '问题编号': 'IQC-2024-004',
            '来料批次': 'LOT-20241204-D',
            '供应商': '广州AA精密制造有限公司',
            '物料名称': '触摸屏',
            '物料型号': 'TP-6.1-CAP-004',
            '问题描述': '触摸响应不灵敏，存在死区',
            '问题分类': '功能异常',
            '严重程度': 'S1',
            '发现时间': '2024-12-04 08:45:00',
            '发现人员': '赵六',
            '影响产品': 'MyPhoneX',
            '影响数量': 300,
            '处理状态': '处理中',
            '根本原因': 'ITO导电层工艺缺陷',
            '纠正措施': '重新制作ITO导电层',
            '预防措施': '加强ITO层质量控制',
            '关闭时间': None,
            '备注': '已退回供应商重工'
        },
        {
            '问题编号': 'IQC-2024-005',
            '来料批次': 'LOT-20241205-E',
            '供应商': '深圳BB电子有限公司',
            '物料名称': '扬声器',
            '物料型号': 'SPK-STEREO-005',
            '问题描述': '扬声器音质异常，有杂音',
            '问题分类': '性能不达标',
            '严重程度': 'S3',
            '发现时间': '2024-12-05 15:30:00',
            '发现人员': '孙七',
            '影响产品': 'MyPhoneY',
            '影响数量': 100,
            '处理状态': '已关闭',
            '根本原因': '磁铁磁力不足',
            '纠正措施': '更换高性能磁铁',
            '预防措施': '建立磁力测试标准',
            '关闭时间': '2024-12-06 10:00:00',
            '备注': '已验证新批次合格'
        }
    ]
    
    return pd.DataFrame(sample_data)

def create_related_test_cases():
    """创建相关测试用例数据"""
    
    test_cases = [
        {
            '用例编号': 'TC-CAM-001',
            '用例名称': '摄像头对焦功能测试',
            '测试模块': '摄像头',
            '优先级': 'P1',
            '测试步骤': '1.启动相机应用 2.选择拍照模式 3.半按快门对焦 4.检查对焦效果',
            '预期结果': '能够快速准确对焦，图像清晰',
            '关联产品': 'MyPhoneX,MyPhoneY,MyPhoneZ'
        },
        {
            '用例编号': 'TC-BAT-001',
            '用例名称': '电池充电性能测试',
            '测试模块': '电池',
            '优先级': 'P1',
            '测试步骤': '1.电池电量降至5% 2.连接充电器 3.记录充电时间 4.检查充电速度',
            '预期结果': '充电速度符合规格要求',
            '关联产品': 'MyPhoneX,MyPhoneY'
        },
        {
            '用例编号': 'TC-LCD-001',
            '用例名称': '显示屏色彩准确性测试',
            '测试模块': '显示屏',
            '优先级': 'P2',
            '测试步骤': '1.显示标准色卡 2.使用色度计测量 3.对比标准值 4.记录偏差',
            '预期结果': '色彩偏差在允许范围内',
            '关联产品': 'MyPhoneZ'
        },
        {
            '用例编号': 'TC-TP-001',
            '用例名称': '触摸屏响应测试',
            '测试模块': '触摸屏',
            '优先级': 'P1',
            '测试步骤': '1.全屏触摸测试 2.多点触控测试 3.边缘触摸测试 4.检查响应时间',
            '预期结果': '触摸响应灵敏，无死区',
            '关联产品': 'MyPhoneX,MyPhoneY,MyPhoneZ'
        },
        {
            '用例编号': 'TC-SPK-001',
            '用例名称': '扬声器音质测试',
            '测试模块': '扬声器',
            '优先级': 'P2',
            '测试步骤': '1.播放标准音频 2.测量音量分贝 3.检查音质清晰度 4.测试频响范围',
            '预期结果': '音质清晰，无杂音',
            '关联产品': 'MyPhoneY'
        }
    ]
    
    return pd.DataFrame(test_cases)

def main():
    """主函数"""
    print("🚀 创建示例数据文件")
    
    # 确保目录存在
    data_dir = Path('data/import')
    data_dir.mkdir(parents=True, exist_ok=True)
    
    # 创建来料问题数据
    problems_df = create_sample_excel_data()
    problems_file = data_dir / '来料问题先后版.xlsx'
    problems_df.to_excel(problems_file, index=False)
    print(f"✅ 创建来料问题数据: {problems_file}")
    print(f"   - 行数: {len(problems_df)}")
    print(f"   - 列数: {len(problems_df.columns)}")
    
    # 创建测试用例数据
    testcases_df = create_related_test_cases()
    testcases_file = data_dir / '相关测试用例.xlsx'
    testcases_df.to_excel(testcases_file, index=False)
    print(f"✅ 创建测试用例数据: {testcases_file}")
    print(f"   - 行数: {len(testcases_df)}")
    print(f"   - 列数: {len(testcases_df.columns)}")
    
    # 显示数据预览
    print(f"\n📋 来料问题数据预览:")
    print(problems_df[['问题编号', '物料名称', '问题描述', '严重程度', '处理状态']].head())
    
    print(f"\n📋 测试用例数据预览:")
    print(testcases_df[['用例编号', '用例名称', '测试模块', '优先级']].head())

if __name__ == "__main__":
    main()
