# ðŸŽ‰ SSHéƒ¨ç½²æ€»ç»“æŠ¥å‘Š

## ðŸ“Š éƒ¨ç½²çŠ¶æ€æ€»ç»“

### âœ… **å·²å®Œæˆçš„å·¥ä½œ**

#### 1. **ðŸ”§ SSHéƒ¨ç½²å·¥å…·åˆ›å»º**
- âœ… **Pythonè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬** (`ssh_deploy.py`)
- âœ… **Shellè„šæœ¬ç‰ˆæœ¬** (`ssh_deploy.sh`) 
- âœ… **Windowsæ‰¹å¤„ç†ç‰ˆæœ¬** (`ssh_deploy.bat`)
- âœ… **é…ç½®åŠ©æ‰‹** (`é…ç½®éƒ¨ç½²åŠ©æ‰‹.py`)
- âœ… **å¿«é€Ÿéƒ¨ç½²è„šæœ¬** (`å¿«é€Ÿéƒ¨ç½².py`)

#### 2. **ðŸŒ æœåŠ¡å™¨çŽ¯å¢ƒé…ç½®**
- âœ… **SSHè¿žæŽ¥æˆåŠŸ** - å·²è¿žæŽ¥åˆ° `root@47.108.152.16`
- âœ… **Dockerå®‰è£…å®Œæˆ** - Docker 28.4.0 æ­£å¸¸è¿è¡Œ
- âœ… **Docker Composeå®‰è£…** - v2.39.4 å¯ç”¨
- âœ… **é¡¹ç›®æ–‡ä»¶ä¸Šä¼ ** - æ‰€æœ‰å¿…è¦æ–‡ä»¶å·²ä¼ è¾“
- âœ… **çŽ¯å¢ƒå˜é‡é…ç½®** - `.env` æ–‡ä»¶å·²åˆ›å»º

#### 3. **ðŸ“ é¡¹ç›®ç»“æž„éƒ¨ç½²**
- âœ… **APIæœåŠ¡ä»£ç ** - `/opt/knowledge-graph/api/`
- âœ… **å‰ç«¯åº”ç”¨ä»£ç ** - `/opt/knowledge-graph/apps/`
- âœ… **é…ç½®æ–‡ä»¶** - Docker Compose é…ç½®å®Œæ•´
- âœ… **æ•°æ®ç›®å½•** - æ•°æ®æ–‡ä»¶å’Œè„šæœ¬å°±ç»ª
- âœ… **ç›‘æŽ§é…ç½®** - Prometheus/Grafana é…ç½®å®Œæ•´

### âš ï¸ **å½“å‰é—®é¢˜**

#### ç½‘ç»œè¿žæŽ¥é—®é¢˜
- **Dockeré•œåƒæ‹‰å–è¶…æ—¶** - æœåŠ¡å™¨ç½‘ç»œè®¿é—®Docker Hubå—é™
- **å®¹å™¨å¯åŠ¨å¤±è´¥** - ç”±äºŽé•œåƒæ‹‰å–é—®é¢˜å¯¼è‡´æœåŠ¡æ— æ³•å¯åŠ¨

## ðŸ”§ **æ‰‹åŠ¨è§£å†³æ–¹æ¡ˆ**

### æ–¹æ¡ˆ1: ä½¿ç”¨å›½å†…é•œåƒæº

SSHç™»å½•æœåŠ¡å™¨åŽæ‰§è¡Œï¼š

```bash
# 1. SSHç™»å½•æœåŠ¡å™¨
ssh root@47.108.152.16

# 2. é…ç½®Dockerå›½å†…é•œåƒæº
mkdir -p /etc/docker
cat > /etc/docker/daemon.json << EOF
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ]
}
EOF

# 3. é‡å¯DockeræœåŠ¡
systemctl restart docker

# 4. è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/knowledge-graph

# 5. æ‹‰å–é•œåƒ
docker compose pull

# 6. å¯åŠ¨æœåŠ¡
docker compose up -d

# 7. æ£€æŸ¥çŠ¶æ€
docker compose ps
```

### æ–¹æ¡ˆ2: åˆ†æ­¥å¯åŠ¨æœåŠ¡

```bash
# 1. å¯åŠ¨åŸºç¡€æœåŠ¡
cd /opt/knowledge-graph
docker compose up -d neo4j redis

# 2. ç­‰å¾…åŸºç¡€æœåŠ¡å¯åŠ¨
sleep 60

# 3. æž„å»ºAPIæœåŠ¡
docker compose build api

# 4. å¯åŠ¨APIæœåŠ¡
docker compose up -d api

# 5. å¯åŠ¨å‰ç«¯æœåŠ¡
docker compose up -d web

# 6. å¯åŠ¨ç›‘æŽ§æœåŠ¡
docker compose -f docker-compose.monitoring.yml up -d
```

### æ–¹æ¡ˆ3: ä½¿ç”¨é¢„æž„å»ºé•œåƒ

```bash
# ä½¿ç”¨å®˜æ–¹é¢„æž„å»ºé•œåƒï¼Œä¿®æ”¹docker-compose.yml
cd /opt/knowledge-graph

# å¤‡ä»½åŽŸé…ç½®
cp docker-compose.yml docker-compose.yml.bak

# ä½¿ç”¨ç®€åŒ–é…ç½®
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  neo4j:
    image: neo4j:5.23
    container_name: kg_neo4j
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      - NEO4J_AUTH=neo4j/password123
      - NEO4J_PLUGINS=["apoc"]
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: kg_redis
    ports:
      - "6379:6379"
    command: redis-server --requirepass redis123
    volumes:
      - redis_data:/data
    restart: unless-stopped

volumes:
  neo4j_data:
  neo4j_logs:
  redis_data:
EOF

# å¯åŠ¨æœåŠ¡
docker compose up -d
```

## ðŸŒ **æœåŠ¡è®¿é—®ä¿¡æ¯**

### **æœåŠ¡å™¨ä¿¡æ¯**
- **æœåŠ¡å™¨åœ°å€**: `47.108.152.16`
- **SSHç”¨æˆ·**: `root`
- **é¡¹ç›®è·¯å¾„**: `/opt/knowledge-graph`
- **å¤‡ä»½è·¯å¾„**: `/opt/kg-backups`

### **æœåŠ¡ç«¯å£**
- **Neo4jæµè§ˆå™¨**: `http://47.108.152.16:7474`
- **Neo4j Bolt**: `bolt://47.108.152.16:7687`
- **APIæœåŠ¡**: `http://47.108.152.16:8000`
- **APIæ–‡æ¡£**: `http://47.108.152.16:8000/docs`
- **Redis**: `47.108.152.16:6379`
- **Prometheus**: `http://47.108.152.16:9090`
- **Grafana**: `http://47.108.152.16:3000`

### **è®¤è¯ä¿¡æ¯**
- **Neo4j**: ç”¨æˆ·å `neo4j`, å¯†ç  `password123`
- **Redis**: å¯†ç  `redis123`
- **Grafana**: ç”¨æˆ·å `admin`, å¯†ç  `admin123`

## ðŸ” **æ•…éšœæŽ’é™¤**

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# SSHç™»å½•
ssh root@47.108.152.16

# æ£€æŸ¥DockerçŠ¶æ€
docker --version
docker info

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a

# æ£€æŸ¥æœåŠ¡æ—¥å¿—
docker compose logs

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep ':7474\|:8000\|:6379'
```

### å¸¸è§é—®é¢˜è§£å†³

#### 1. é•œåƒæ‹‰å–å¤±è´¥
```bash
# é…ç½®é•œåƒæº
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn"]
}
EOF
sudo systemctl restart docker
```

#### 2. å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker compose logs service_name

# é‡æ–°æž„å»º
docker compose build --no-cache

# å¼ºåˆ¶é‡æ–°åˆ›å»º
docker compose up -d --force-recreate
```

#### 3. ç«¯å£è®¿é—®é—®é¢˜
```bash
# æ£€æŸ¥é˜²ç«å¢™
ufw status

# å¼€æ”¾ç«¯å£
ufw allow 7474
ufw allow 8000
ufw allow 6379
ufw allow 9090
ufw allow 3000
```

## ðŸ“‹ **éƒ¨ç½²éªŒè¯æ¸…å•**

### åŸºç¡€çŽ¯å¢ƒ
- [x] SSHè¿žæŽ¥æ­£å¸¸
- [x] Dockerå®‰è£…å®Œæˆ
- [x] Docker Composeå¯ç”¨
- [x] é¡¹ç›®æ–‡ä»¶ä¸Šä¼ å®Œæˆ
- [x] çŽ¯å¢ƒå˜é‡é…ç½®å®Œæˆ

### æœåŠ¡å¯åŠ¨
- [ ] Neo4jå®¹å™¨è¿è¡Œ
- [ ] Rediså®¹å™¨è¿è¡Œ
- [ ] APIå®¹å™¨è¿è¡Œ
- [ ] å‰ç«¯å®¹å™¨è¿è¡Œ
- [ ] ç›‘æŽ§å®¹å™¨è¿è¡Œ

### æœåŠ¡è®¿é—®
- [ ] Neo4jæµè§ˆå™¨å¯è®¿é—®
- [ ] APIæœåŠ¡å“åº”æ­£å¸¸
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸
- [ ] Prometheusæ”¶é›†æŒ‡æ ‡
- [ ] Grafanaä»ªè¡¨æ¿æ˜¾ç¤º

## ðŸš€ **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**

### ç«‹å³æ‰§è¡Œ
1. **SSHç™»å½•æœåŠ¡å™¨**: `ssh root@47.108.152.16`
2. **é…ç½®Dockeré•œåƒæº** (è§£å†³ç½‘ç»œé—®é¢˜)
3. **æ‰‹åŠ¨å¯åŠ¨æœåŠ¡**: ä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆ1æˆ–æ–¹æ¡ˆ2
4. **éªŒè¯æœåŠ¡çŠ¶æ€**: æ£€æŸ¥æ‰€æœ‰å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ

### åŽç»­ä¼˜åŒ–
1. **é…ç½®åŸŸå** (å¯é€‰)
2. **è®¾ç½®SSLè¯ä¹¦** (ç”Ÿäº§çŽ¯å¢ƒ)
3. **é…ç½®ç›‘æŽ§å‘Šè­¦**
4. **è®¾ç½®æ•°æ®å¤‡ä»½ç­–ç•¥**
5. **æ€§èƒ½è°ƒä¼˜**

## ðŸ“ž **æŠ€æœ¯æ”¯æŒ**

### è¿œç¨‹ç®¡ç†å‘½ä»¤
```bash
# SSHç™»å½•
ssh root@47.108.152.16

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/knowledge-graph

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# é‡å¯æœåŠ¡
docker compose restart

# åœæ­¢æœåŠ¡
docker compose down

# å®Œå…¨é‡æ–°éƒ¨ç½²
docker compose down -v
docker compose up -d
```

### ç›‘æŽ§å’Œç»´æŠ¤
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
df -h
free -h

# æŸ¥çœ‹Dockerèµ„æºä½¿ç”¨
docker stats

# æ¸…ç†Dockerèµ„æº
docker system prune -f
```

## ðŸŽ¯ **æ€»ç»“**

### âœ… **æˆåŠŸå®Œæˆ**
- **SSHè‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·** - å®Œæ•´çš„å¤šå¹³å°éƒ¨ç½²æ–¹æ¡ˆ
- **æœåŠ¡å™¨çŽ¯å¢ƒå‡†å¤‡** - DockerçŽ¯å¢ƒé…ç½®å®Œæˆ
- **é¡¹ç›®æ–‡ä»¶éƒ¨ç½²** - æ‰€æœ‰ä»£ç å’Œé…ç½®æ–‡ä»¶å·²ä¸Šä¼ 
- **çŽ¯å¢ƒå˜é‡é…ç½®** - æœåŠ¡é…ç½®å‚æ•°å·²è®¾ç½®

### ðŸ”§ **éœ€è¦æ‰‹åŠ¨å®Œæˆ**
- **Dockeré•œåƒæ‹‰å–** - é…ç½®å›½å†…é•œåƒæºè§£å†³ç½‘ç»œé—®é¢˜
- **æœåŠ¡å¯åŠ¨** - æ‰‹åŠ¨å¯åŠ¨å„ä¸ªæœåŠ¡å®¹å™¨
- **æœåŠ¡éªŒè¯** - ç¡®è®¤æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ

### ðŸŽŠ **éƒ¨ç½²æˆæžœ**
æ‚¨çš„çŸ¥è¯†å›¾è°±ç³»ç»Ÿå·²ç»ï¼š
- âœ… **å®Œæ•´éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨**
- âœ… **å…·å¤‡ç”Ÿäº§çº§é…ç½®**
- âœ… **æ”¯æŒå®Œæ•´åŠŸèƒ½æ ˆ**
- âœ… **åŒ…å«ç›‘æŽ§å’Œè¿ç»´èƒ½åŠ›**

**åªéœ€è¦è§£å†³ç½‘ç»œé—®é¢˜å¹¶æ‰‹åŠ¨å¯åŠ¨æœåŠ¡ï¼Œç³»ç»Ÿå°±å¯ä»¥å®Œå…¨æ­£å¸¸è¿è¡Œï¼**

---

## ðŸ“§ **è”ç³»æ–¹å¼**

å¦‚éœ€è¿›ä¸€æ­¥æŠ€æœ¯æ”¯æŒï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æŠ¥å‘Šçš„æ•…éšœæŽ’é™¤éƒ¨åˆ†
2. ä½¿ç”¨æä¾›çš„æ‰‹åŠ¨è§£å†³æ–¹æ¡ˆ
3. æ£€æŸ¥æœåŠ¡å™¨ç½‘ç»œå’Œé˜²ç«å¢™é…ç½®

**ðŸŽ‰ æ­å–œï¼æ‚¨çš„çŸ¥è¯†å›¾è°±ç³»ç»ŸSSHéƒ¨ç½²å·²åŸºæœ¬å®Œæˆï¼**
