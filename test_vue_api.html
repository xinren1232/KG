<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue API测试</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
</head>
<body>
    <div id="app">
        <h1>Vue API测试</h1>
        <el-button @click="testAPIs" type="primary" :loading="loading">测试所有API</el-button>
        <div v-if="results.length > 0" style="margin-top: 20px;">
            <h3>测试结果:</h3>
            <ul>
                <li v-for="result in results" :key="result.name" :style="{color: result.success ? 'green' : 'red'}">
                    {{ result.name }}: {{ result.message }}
                </li>
            </ul>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElButton, ElMessage } = ElementPlus;

        // 模拟kgApi
        const kgApi = {
            baseURL: 'http://localhost:8000',
            
            async healthCheck() {
                const response = await axios.get(`${this.baseURL}/health`);
                return response.data;
            },
            
            async getFiles() {
                const response = await axios.get(`${this.baseURL}/kg/files`);
                return response.data;
            },
            
            async getEntities(entityType = null, limit = 100) {
                const params = { limit };
                if (entityType) params.entity_type = entityType;
                const response = await axios.get(`${this.baseURL}/kg/entities`, { params });
                return response.data;
            },
            
            async getGraphStats() {
                const response = await axios.get(`${this.baseURL}/kg/stats`);
                return response.data;
            },
            
            async queryGraph(cypherQuery, parameters = {}) {
                const response = await axios.post(`${this.baseURL}/kg/query`, {
                    cypher_query: cypherQuery,
                    parameters
                });
                return response.data;
            },
            
            async getGraphData(nodeLimit = 100, includeRelations = true) {
                const response = await axios.get(`${this.baseURL}/kg/graph/data`, {
                    params: {
                        node_limit: nodeLimit,
                        include_relations: includeRelations
                    }
                });
                return response.data;
            }
        };

        createApp({
            components: {
                ElButton
            },
            data() {
                return {
                    loading: false,
                    results: []
                };
            },
            methods: {
                async testAPIs() {
                    this.loading = true;
                    this.results = [];
                    
                    const tests = [
                        { name: '健康检查', method: () => kgApi.healthCheck() },
                        { name: '文件列表', method: () => kgApi.getFiles() },
                        { name: '实体获取', method: () => kgApi.getEntities() },
                        { name: '统计信息', method: () => kgApi.getGraphStats() },
                        { name: '图谱查询', method: () => kgApi.queryGraph('MATCH (n:Entity) RETURN n.type as entity_type, count(n) as count ORDER BY count DESC') },
                        { name: '图谱数据', method: () => kgApi.getGraphData() }
                    ];
                    
                    for (const test of tests) {
                        try {
                            const result = await test.method();
                            this.results.push({
                                name: test.name,
                                success: true,
                                message: `成功 - ${JSON.stringify(result).substring(0, 100)}...`
                            });
                        } catch (error) {
                            this.results.push({
                                name: test.name,
                                success: false,
                                message: `失败 - ${error.message}`
                            });
                        }
                    }
                    
                    this.loading = false;
                    
                    const successCount = this.results.filter(r => r.success).length;
                    if (successCount === tests.length) {
                        ElMessage.success('所有API测试通过！');
                    } else {
                        ElMessage.warning(`${successCount}/${tests.length} 个API测试通过`);
                    }
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
