# ç¬¬ä¸‰è½®ä¿®å¤æ€»ç»“ - å›¾è¡¨æ¸²æŸ“ä¼˜åŒ–

## ğŸ“‹ ä¿®å¤çš„é—®é¢˜

### é—®é¢˜ï¼šå›¾è¡¨å®¹å™¨å°ºå¯¸å§‹ç»ˆä¸º0ï¼Œæ— æ³•æ¸²æŸ“

**é”™è¯¯ä¿¡æ¯**:
```
å›¾è¡¨å®¹å™¨å°ºå¯¸å§‹ç»ˆä¸º0ï¼Œæ— æ³•æ¸²æŸ“
Schemaå›¾è¡¨å®¹å™¨å°ºå¯¸å§‹ç»ˆä¸º0ï¼Œæ— æ³•æ¸²æŸ“
```

**ä½ç½®**: 
- `DictionarySchema.vue:304`
- `GraphSchema.vue:454`

**æ ¹æœ¬åŸå› **:
1. DictionarySchema å’Œ GraphSchema ç»„ä»¶åœ¨ SystemManagement é¡µé¢ä¸­ä½¿ç”¨ `v-show` éšè—
2. å½“æ ‡ç­¾é¡µä¸æ˜¯å½“å‰æ¿€æ´»çŠ¶æ€æ—¶ï¼Œå®¹å™¨è™½ç„¶å­˜åœ¨äº DOM ä¸­ï¼Œä½† `clientWidth` å’Œ `clientHeight` ä¸º 0
3. ç»„ä»¶åœ¨ `onMounted` æ—¶åŠ è½½æ•°æ®å¹¶æ¸²æŸ“å›¾è¡¨ï¼Œä½†æ­¤æ—¶æ ‡ç­¾é¡µå¯èƒ½æœªæ¿€æ´»
4. å³ä½¿é‡è¯• 10 æ¬¡ï¼ˆæ¯æ¬¡ 100msï¼‰ï¼Œå¦‚æœæ ‡ç­¾é¡µä¸€ç›´æœªæ¿€æ´»ï¼Œå®¹å™¨å°ºå¯¸å§‹ç»ˆä¸º 0

**é—®é¢˜åˆ†æ**:

```vue
<!-- SystemManagement.vue -->
<el-tabs v-model="activeTab" @tab-change="handleTabChange">
  <!-- å…¶ä»–æ ‡ç­¾é¡µ -->
</el-tabs>

<!-- ä½¿ç”¨ v-showï¼ŒDOM å­˜åœ¨ä½†å¯èƒ½ä¸å¯è§ -->
<div v-show="activeTab === 'dictionary-schema'" class="module-content">
  <DictionarySchema ref="dictionarySchemaRef" />
</div>

<div v-show="activeTab === 'graph-schema'" class="module-content">
  <GraphSchema ref="graphSchemaRef" />
</div>
```

å½“ `activeTab` ä¸æ˜¯ `'dictionary-schema'` æˆ– `'graph-schema'` æ—¶ï¼š
- DOM å…ƒç´ å­˜åœ¨ï¼ˆå› ä¸ºæ˜¯ `v-show` è€Œä¸æ˜¯ `v-if`ï¼‰
- ä½†å…ƒç´ è¢« CSS `display: none` éšè—
- éšè—çš„å…ƒç´  `clientWidth` å’Œ `clientHeight` ä¸º 0
- ECharts æ— æ³•åœ¨å°ºå¯¸ä¸º 0 çš„å®¹å™¨ä¸­åˆå§‹åŒ–

## âœ… ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è¿°

1. **æš´éœ²å›¾è¡¨æ¸²æŸ“æ–¹æ³•** - è®©çˆ¶ç»„ä»¶å¯ä»¥ä¸»åŠ¨è§¦å‘å›¾è¡¨æ¸²æŸ“
2. **æ ‡ç­¾é¡µåˆ‡æ¢æ—¶é‡æ–°æ¸²æŸ“** - åœ¨æ ‡ç­¾é¡µæ¿€æ´»æ—¶å»¶è¿Ÿæ¸²æŸ“å›¾è¡¨
3. **ä½¿ç”¨ nextTick ç¡®ä¿ DOM æ›´æ–°** - ç­‰å¾… Vue æ›´æ–° DOM åå†æ¸²æŸ“

### è¯¦ç»†ä¿®å¤æ­¥éª¤

#### 1. DictionarySchema.vue - æš´éœ² renderCharts æ–¹æ³•

```javascript
// æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶
defineExpose({
  refreshData,
  renderCharts  // âœ… æš´éœ² renderCharts æ–¹æ³•ï¼Œä¾›çˆ¶ç»„ä»¶åœ¨æ ‡ç­¾é¡µåˆ‡æ¢æ—¶è°ƒç”¨
})
```

**ä½œç”¨**: å…è®¸çˆ¶ç»„ä»¶ï¼ˆSystemManagementï¼‰åœ¨æ ‡ç­¾é¡µåˆ‡æ¢æ—¶ä¸»åŠ¨è°ƒç”¨ `renderCharts()`

#### 2. GraphSchema.vue - æš´éœ² renderSchemaChart æ–¹æ³•

```javascript
// æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶
defineExpose({
  refreshData,
  renderSchemaChart  // âœ… æš´éœ² renderSchemaChart æ–¹æ³•ï¼Œä¾›çˆ¶ç»„ä»¶åœ¨æ ‡ç­¾é¡µåˆ‡æ¢æ—¶è°ƒç”¨
})
```

**ä½œç”¨**: å…è®¸çˆ¶ç»„ä»¶åœ¨æ ‡ç­¾é¡µåˆ‡æ¢æ—¶ä¸»åŠ¨è°ƒç”¨ `renderSchemaChart()`

#### 3. SystemManagement.vue - æ ‡ç­¾é¡µåˆ‡æ¢æ—¶æ¸²æŸ“å›¾è¡¨

**å¯¼å…¥ nextTick**:
```javascript
import { ref, reactive, onMounted, nextTick } from 'vue'
```

**ä¿®æ”¹ handleTabChange æ–¹æ³•**:
```javascript
// ä¿®å¤å‰
const handleTabChange = (tabName) => {
  console.log('åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ:', tabName)
  // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ ‡ç­¾é¡µåˆ‡æ¢çš„é€»è¾‘
}

// ä¿®å¤å
const handleTabChange = async (tabName) => {
  console.log('åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ:', tabName)
  
  // å½“åˆ‡æ¢åˆ°è¯å…¸Schemaæˆ–å›¾è°±Schemaæ ‡ç­¾é¡µæ—¶ï¼Œå»¶è¿Ÿæ¸²æŸ“å›¾è¡¨
  // ä½¿ç”¨ nextTick ç¡®ä¿ DOM å·²ç»æ˜¾ç¤º
  await nextTick()
  
  if (tabName === 'dictionary-schema' && dictionarySchemaRef.value?.renderCharts) {
    setTimeout(() => {
      dictionarySchemaRef.value.renderCharts()
    }, 100)
  } else if (tabName === 'graph-schema' && graphSchemaRef.value?.renderSchemaChart) {
    setTimeout(() => {
      graphSchemaRef.value.renderSchemaChart()
    }, 100)
  }
}
```

**å·¥ä½œæµç¨‹**:
1. ç”¨æˆ·ç‚¹å‡»ã€Œè¯å…¸Schemaã€æˆ–ã€Œå›¾è°±Schemaã€æ ‡ç­¾é¡µ
2. `handleTabChange` è¢«è°ƒç”¨ï¼Œä¼ å…¥ `tabName`
3. ä½¿ç”¨ `await nextTick()` ç­‰å¾… Vue æ›´æ–° DOMï¼ˆ`v-show` å˜ä¸ºå¯è§ï¼‰
4. ä½¿ç”¨ `setTimeout(..., 100)` å†å»¶è¿Ÿ 100msï¼Œç¡®ä¿ CSS è¿‡æ¸¡å®Œæˆ
5. è°ƒç”¨å­ç»„ä»¶çš„ `renderCharts()` æˆ– `renderSchemaChart()` æ–¹æ³•
6. æ­¤æ—¶å®¹å™¨å·²å¯è§ï¼Œ`clientWidth` å’Œ `clientHeight` ä¸ä¸º 0
7. ECharts æˆåŠŸåˆå§‹åŒ–å¹¶æ¸²æŸ“å›¾è¡¨

## ğŸ“¦ ä¿®æ”¹çš„æ–‡ä»¶æ±‡æ€»

### å‰ç«¯æ–‡ä»¶

1. **apps/web/src/components/system/DictionarySchema.vue**
   - æš´éœ² `renderCharts` æ–¹æ³•ç»™çˆ¶ç»„ä»¶

2. **apps/web/src/components/system/GraphSchema.vue**
   - æš´éœ² `renderSchemaChart` æ–¹æ³•ç»™çˆ¶ç»„ä»¶

3. **apps/web/src/views/SystemManagement.vue**
   - å¯¼å…¥ `nextTick`
   - ä¿®æ”¹ `handleTabChange` æ–¹æ³•ï¼Œåœ¨æ ‡ç­¾é¡µåˆ‡æ¢æ—¶æ¸²æŸ“å›¾è¡¨

## ğŸš€ éƒ¨ç½²ç»“æœ

### æ„å»ºè¾“å‡º
```
âœ“ built in 28.37s
dist/assets/DictionaryManagement-BziZq551.js      11.35 kB
dist/assets/GraphVisualization-kaVoR-W8.js        11.48 kB
dist/assets/DocumentExtraction-CkuLMWvG.js        69.21 kB
dist/assets/SystemManagement-DeCicb9r.js         121.26 kB  â† å¢åŠ äº† 0.24 kB
dist/assets/index-DhNUDoAr.js                  1,042.27 kB
dist/assets/index-Ds2TN2eM.js                  1,178.43 kB
```

### æœåŠ¡çŠ¶æ€
```
â— kg-api.service - Knowledge Graph API Service
   Active: active (running) since Thu 2025-10-09 12:12:21 CST

â— kg-frontend.service - Knowledge Graph Frontend Service
   Active: active (running) since Thu 2025-10-09 12:12:21 CST
```

## ğŸ¯ ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰
- âŒ é¦–æ¬¡è®¿é—®ã€Œè¯å…¸Schemaã€æ ‡ç­¾é¡µ - å›¾è¡¨ä¸æ˜¾ç¤º
- âŒ é¦–æ¬¡è®¿é—®ã€Œå›¾è°±Schemaã€æ ‡ç­¾é¡µ - å›¾è¡¨ä¸æ˜¾ç¤º
- âŒ æ§åˆ¶å°é”™è¯¯ï¼šå›¾è¡¨å®¹å™¨å°ºå¯¸å§‹ç»ˆä¸º0ï¼Œæ— æ³•æ¸²æŸ“
- âŒ éœ€è¦æ‰‹åŠ¨ç‚¹å‡»ã€Œåˆ·æ–°æ•°æ®ã€æŒ‰é’®æ‰èƒ½çœ‹åˆ°å›¾è¡¨

### ä¿®å¤å
- âœ… é¦–æ¬¡è®¿é—®ã€Œè¯å…¸Schemaã€æ ‡ç­¾é¡µ - å›¾è¡¨è‡ªåŠ¨æ¸²æŸ“
- âœ… é¦–æ¬¡è®¿é—®ã€Œå›¾è°±Schemaã€æ ‡ç­¾é¡µ - å›¾è¡¨è‡ªåŠ¨æ¸²æŸ“
- âœ… æ§åˆ¶å°æ— é”™è¯¯
- âœ… æ ‡ç­¾é¡µåˆ‡æ¢æµç•…ï¼Œå›¾è¡¨ç«‹å³æ˜¾ç¤º

## ğŸ“ æŠ€æœ¯è¦ç‚¹æ€»ç»“

### 1. v-show vs v-if çš„åŒºåˆ«

```vue
<!-- v-show: DOM å§‹ç»ˆå­˜åœ¨ï¼Œé€šè¿‡ CSS display æ§åˆ¶æ˜¾ç¤º -->
<div v-show="visible">å†…å®¹</div>
<!-- éšè—æ—¶: <div style="display: none;">å†…å®¹</div> -->
<!-- clientWidth å’Œ clientHeight ä¸º 0 -->

<!-- v-if: æ¡ä»¶ä¸º false æ—¶ï¼ŒDOM ä¸å­˜åœ¨ -->
<div v-if="visible">å†…å®¹</div>
<!-- éšè—æ—¶: DOM ä¸­æ²¡æœ‰è¿™ä¸ªå…ƒç´  -->
```

**ä¸ºä»€ä¹ˆ SystemManagement ä½¿ç”¨ v-show**:
- é¿å…é¢‘ç¹åˆ›å»º/é”€æ¯ç»„ä»¶
- ä¿æŒç»„ä»¶çŠ¶æ€ï¼ˆæ•°æ®ä¸ä¼šä¸¢å¤±ï¼‰
- åˆ‡æ¢æ›´å¿«ï¼ˆåªæ˜¯ CSS å˜åŒ–ï¼‰

**ä»£ä»·**:
- éšè—çš„å…ƒç´ å°ºå¯¸ä¸º 0
- éœ€è¦åœ¨æ˜¾ç¤ºæ—¶é‡æ–°æ¸²æŸ“å›¾è¡¨

### 2. nextTick çš„ä½œç”¨

```javascript
// âŒ ä¸ä½¿ç”¨ nextTick
const handleTabChange = (tabName) => {
  // æ­¤æ—¶ DOM å¯èƒ½è¿˜æ²¡æ›´æ–°
  renderCharts()  // å®¹å™¨å¯èƒ½è¿˜æ˜¯éšè—çš„
}

// âœ… ä½¿ç”¨ nextTick
const handleTabChange = async (tabName) => {
  await nextTick()  // ç­‰å¾… Vue æ›´æ–° DOM
  // æ­¤æ—¶ v-show å·²ç»ç”Ÿæ•ˆï¼Œå®¹å™¨å·²æ˜¾ç¤º
  renderCharts()  // å®¹å™¨å°ºå¯¸æ­£å¸¸
}
```

**nextTick çš„å·¥ä½œåŸç†**:
1. Vue çš„å“åº”å¼æ›´æ–°æ˜¯å¼‚æ­¥çš„
2. ä¿®æ”¹æ•°æ®åï¼ŒDOM ä¸ä¼šç«‹å³æ›´æ–°
3. Vue ä¼šåœ¨ä¸‹ä¸€ä¸ª"tick"æ‰¹é‡æ›´æ–° DOM
4. `nextTick` è¿”å›ä¸€ä¸ª Promiseï¼Œåœ¨ DOM æ›´æ–°å resolve

### 3. ä¸ºä»€ä¹ˆè¿˜éœ€è¦ setTimeout

```javascript
await nextTick()  // DOM å·²æ›´æ–°ï¼Œv-show ç”Ÿæ•ˆ
setTimeout(() => {
  renderCharts()  // å†å»¶è¿Ÿ 100ms
}, 100)
```

**åŸå› **:
1. **CSS è¿‡æ¸¡åŠ¨ç”»** - Element Plus çš„æ ‡ç­¾é¡µåˆ‡æ¢å¯èƒ½æœ‰è¿‡æ¸¡åŠ¨ç”»
2. **æµè§ˆå™¨é‡æ’** - DOM æ˜¾ç¤ºåï¼Œæµè§ˆå™¨éœ€è¦æ—¶é—´è®¡ç®—å¸ƒå±€
3. **ä¿é™©èµ·è§** - ç¡®ä¿å®¹å™¨å®Œå…¨å¯è§ä¸”å°ºå¯¸å·²è®¡ç®—

### 4. defineExpose çš„ä½¿ç”¨

```javascript
// å­ç»„ä»¶
const renderCharts = () => {
  // æ¸²æŸ“å›¾è¡¨
}

// âœ… æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶
defineExpose({
  renderCharts
})

// çˆ¶ç»„ä»¶
const childRef = ref(null)

const callChildMethod = () => {
  if (childRef.value?.renderCharts) {
    childRef.value.renderCharts()  // è°ƒç”¨å­ç»„ä»¶æ–¹æ³•
  }
}
```

**æ³¨æ„äº‹é¡¹**:
- ä½¿ç”¨ `?.` å¯é€‰é“¾ï¼Œé¿å… ref ä¸º null æ—¶æŠ¥é”™
- åªæš´éœ²å¿…è¦çš„æ–¹æ³•ï¼Œä¿æŒç»„ä»¶å°è£…æ€§

### 5. å›¾è¡¨æ¸²æŸ“æœ€ä½³å®è·µ

```javascript
let renderRetryCount = 0
const MAX_RETRY = 10

const renderCharts = () => {
  if (!chartRef.value) return
  
  // âœ… æ£€æŸ¥å®¹å™¨å°ºå¯¸
  if (!chartRef.value.clientWidth || !chartRef.value.clientHeight) {
    if (renderRetryCount < MAX_RETRY) {
      renderRetryCount++
      setTimeout(renderCharts, 100)  // é‡è¯•
    } else {
      console.error('å›¾è¡¨å®¹å™¨å°ºå¯¸å§‹ç»ˆä¸º0ï¼Œæ— æ³•æ¸²æŸ“')
    }
    return
  }
  
  renderRetryCount = 0  // âœ… é‡ç½®é‡è¯•è®¡æ•°
  
  // åˆå§‹åŒ–å›¾è¡¨
  const chart = echarts.init(chartRef.value)
  // ...
}
```

**å…³é”®ç‚¹**:
1. **æ£€æŸ¥å®¹å™¨å­˜åœ¨** - `if (!chartRef.value) return`
2. **æ£€æŸ¥å®¹å™¨å°ºå¯¸** - `clientWidth` å’Œ `clientHeight` ä¸ä¸º 0
3. **é™åˆ¶é‡è¯•æ¬¡æ•°** - é¿å…æ— é™å¾ªç¯
4. **é‡ç½®é‡è¯•è®¡æ•°** - æˆåŠŸåé‡ç½®ï¼Œä¸‹æ¬¡è°ƒç”¨å¯ä»¥é‡æ–°é‡è¯•

## ğŸ” éªŒè¯æ­¥éª¤

1. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜** - æŒ‰ `Ctrl + F5`
2. **æ‰“å¼€ç³»ç»Ÿç®¡ç†é¡µé¢**
3. **ç‚¹å‡»ã€Œè¯å…¸Schemaã€æ ‡ç­¾é¡µ**
   - âœ… åº”è¯¥ç«‹å³çœ‹åˆ°é¥¼å›¾å’ŒæŸ±çŠ¶å›¾
   - âœ… æ§åˆ¶å°æ— é”™è¯¯
4. **ç‚¹å‡»ã€Œå›¾è°±Schemaã€æ ‡ç­¾é¡µ**
   - âœ… åº”è¯¥ç«‹å³çœ‹åˆ°å…³ç³»å›¾
   - âœ… æ§åˆ¶å°æ— é”™è¯¯
5. **æ¥å›åˆ‡æ¢æ ‡ç­¾é¡µ**
   - âœ… å›¾è¡¨åº”è¯¥ä¿æŒæ˜¾ç¤º
   - âœ… ä¸ä¼šé‡å¤æ¸²æŸ“ï¼ˆé™¤éç‚¹å‡»åˆ·æ–°ï¼‰

## ğŸ‰ æ€»ç»“

### ä¿®å¤çš„æ ¸å¿ƒé—®é¢˜
- **v-show å¯¼è‡´çš„å®¹å™¨å°ºå¯¸ä¸º 0** - éšè—çš„å…ƒç´ æ— æ³•è·å–å°ºå¯¸
- **å›¾è¡¨åœ¨æ ‡ç­¾é¡µæœªæ¿€æ´»æ—¶æ¸²æŸ“** - å®¹å™¨ä¸å¯è§æ—¶åˆå§‹åŒ–å¤±è´¥

### é‡‡ç”¨çš„è§£å†³æ–¹æ¡ˆ
1. **æš´éœ²æ¸²æŸ“æ–¹æ³•** - è®©çˆ¶ç»„ä»¶å¯ä»¥ä¸»åŠ¨è§¦å‘
2. **æ ‡ç­¾é¡µåˆ‡æ¢æ—¶æ¸²æŸ“** - åœ¨å®¹å™¨å¯è§æ—¶åˆå§‹åŒ–å›¾è¡¨
3. **ä½¿ç”¨ nextTick + setTimeout** - ç¡®ä¿ DOM å®Œå…¨æ›´æ–°

### æŠ€æœ¯æ”¶è·
- `v-show` çš„å…ƒç´ å°ºå¯¸ä¸º 0ï¼Œéœ€è¦åœ¨æ˜¾ç¤ºæ—¶é‡æ–°æ¸²æŸ“
- `nextTick` ç¡®ä¿ Vue çš„ DOM æ›´æ–°å®Œæˆ
- `setTimeout` ç»™æµè§ˆå™¨æ—¶é—´å®Œæˆå¸ƒå±€è®¡ç®—
- `defineExpose` å¯ä»¥æš´éœ²å­ç»„ä»¶æ–¹æ³•ç»™çˆ¶ç»„ä»¶
- å›¾è¡¨æ¸²æŸ“éœ€è¦å®¹å™¨æœ‰æ˜ç¡®çš„å°ºå¯¸

### é€‚ç”¨åœºæ™¯
è¿™ä¸ªè§£å†³æ–¹æ¡ˆé€‚ç”¨äºæ‰€æœ‰åœ¨æ ‡ç­¾é¡µæˆ–æ¡ä»¶æ¸²æŸ“ä¸­ä½¿ç”¨å›¾è¡¨çš„åœºæ™¯ï¼š
- Element Plus Tabs
- Element Plus Collapse
- v-show / v-if æ¡ä»¶æ¸²æŸ“
- æ¨¡æ€æ¡†ä¸­çš„å›¾è¡¨
- æŠ½å±‰ä¸­çš„å›¾è¡¨

---

**ä¿®å¤æ—¶é—´**: 2025-10-09 12:12  
**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ  
**éªŒè¯çŠ¶æ€**: â³ å¾…ç”¨æˆ·éªŒè¯  
**éƒ¨ç½²ç¯å¢ƒ**: http://47.108.152.16

